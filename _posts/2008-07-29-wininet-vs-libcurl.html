---
layout: post
title: wininet vs. libcurl
date: '2008-07-29T23:26:31-07:00'
tags: []
tumblr_url: https://fugugames.tumblr.com/post/110242908556/wininet-vs-libcurl
---
When I worked on an Internet gateway for a startup named Neomar at the end of the dot-com boom, I made the mistake of writing an <a href="http://www.w3.org/Protocols/">HTTP</a> implementation from scratch. It&rsquo;s a good way to learn the nitty-gritty of HTTP, but in retrospect, it would have made sense to use some an already-mature HTTP library.

Recently, I had some more HTTP work come my way, and this time I looked at <a href="http://msdn.microsoft.com/en-us/library/aa383630(VS.85).aspx">Wininet</a>, which comes native with Windows, and <a href="http://curl.haxx.se/libcurl/">libcurl</a>, a popular cross-platform library.

Wininet of course has the advantage of being already there, but it has the painful inelegance typical of Microsoft API&rsquo;s (at least up til .NET) Take this example from the <a href="http://support.microsoft.com/kb/q165298/">Microsoft Knowledge base</a> of how to create a POST request:
<pre>static TCHAR hdrs[] = _T("Content-Type: application/x-www-form-urlencoded");
static TCHAR frmdata[] = _T("name=John+Doe&amp;userid=hithere&amp;other=P%26Q");
static LPSTR accept[2]={"*/*", NULL};</pre>
<pre>// for clarity, error-checking has been removed
HINTERNET hSession = InternetOpen("MyAgent",INTERNET_OPEN_TYPE_PRECONFIG, NULL, NULL, 0);
HINTERNET hConnect = InternetConnect(hSession, _T("ServerNameHere"),INTERNET_DEFAULT_HTTP_PORT, NULL, NULL, INTERNET_SERVICE_HTTP, 0, 1);
HINTERNET hRequest = HttpOpenRequest(hConnect, "POST",_T("FormActionHere"), NULL, NULL, accept, 0, 1);
HttpSendRequest(hRequest, hdrs, strlen(hdrs), frmdata, strlen(frmdata));
// close any valid internet-handles</pre>
Compare with a POST example from the <a href="http://curl.haxx.se/libcurl/c/libcurl-tutorial.html">libcurl tutorial</a>:
<pre>curl_easy_setopt(easyhandle, CURLOPT_POSTFIELDS, data)
curl_easy_setopt(easyhandle, CURLOPT_URL, "http://posthere.com/");
char *data="name=daniel&amp;project=curl";
curl_easy_perform(easyhandle); /* post away! */</pre>
The libcurl example is missing a couple of function calls to be complete - one to initialize libcurl, and one to clean it up. On the other hand, the wininet example is missing a few cleanup calls (one for each of the three HINTERNET handles created), and, a bigger pain, it doesn&rsquo;t take a URL - you would have to call InternetCrackURL and allocate a structure that receives the URL components, then use those components in the example calls.

I&rsquo;ve just started on this project, but I&rsquo;m ready to declare winner.
