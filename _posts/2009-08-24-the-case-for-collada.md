---
layout: post
title: The Case for Collada
date: '2009-08-24T00:01:53-07:00'
tags: []
tumblr_url: https://fugugames.tumblr.com/post/110318377746/the-case-for-collada
---
I’ve heard a lot of programmers complain about [Collada](http://www.collada.org/). Generally, the complaints are the same I hear of XML - awkward syntax, too verbose, other formats are good enough. I have to disagree, at least to the last point. Until XML appeared on the seen (and for some time after), I worked on a lot of projects that had a file format without a precise specification, unless you count the one reader and writer that existed. That’s what happens when someone who hasn’t taken a compiler class (and I have to admit that somehow I got through my undergrad years without one) writes a spec. Little details like what whitespace is allowed (if you think that’s obvious, look at Make and Python), where you can insert linebreaks (and is that a Unix, Mac or Windows linebreak?), and can these sections be in a different order are typically left to the imagination, or the first implementation that breaks.

A format called [Game Exchange](http://www.okino.com/conv/imp_gx.htm), developed by Nichimen Graphics back in the mid-nineties, had a defined grammar and even generated the parser using the grammar (with a commercial tool in the vein of lex/yacc). (It probably only had a grammar because it was left in the hands of a summer intern, Aaron Kennington, who working toward his CS degree. He soon joined the company full time). I always felt uncomfortable with Game Exchange since it wasn’t clear to me whether it was an SDK or a file format. I think the official line was that it was both, but I felt somehow the two were not compatible, and we were in the business of trying to sell the SDK. There were some customers who bought the SDK to write their own converters and some who just wanted to support or work with the file format. Among the latter, Maya had some support for a while, [Okino](http://okino.com/) bought the SDK to include it in their converter package Polytrans, and [HyperEntertainmen](http://hyperentertainment.com/)t uused Game Exchange as a format for their [HyperBowl](http://hyperbowl3d.com/) game because they used Nichimen content creation software. But the HyperBowl folks elected to write a custom Game Exchange reader instead of buying the SDK, and of course, that broke as soon as Game Exchange was upgraded and the upgrade came with a new file format, which I think vindicated my concerns about it’s split personality (and fixing the reader was my first task on the project).

I revisited Game Exchange when I saw that the home version of HyperBowl was no longer supported after the advent of Windows Vista and I asked my old bosses at HyperEntertainment for a license to port it to the [Unity](http://www.unity3d.com/) engine so I could run it on the latest platforms and with the latest graphics technology. To my surprise, they assented with very reasonable terms (which shows you the importance of not burning bridges), and started on Plan A, which consisted of using Polytrans to convert the assets from Game Exchange to something that Unity could accept, e.g. OBJ files. This failed miserably - Polytrans would hang during some of the Game Exchange import and Unity would hang on all of the OBJ import. An email to Polytrans support elicited the assertions that the Game Exchange libraries were at fault and the OBJ files were the best in existence, so Unity was also at fault, and I really should have talked to the guy about my needs before buying Polytrans.

He was right about the OBJ files - I surmised that Unity’s preferred import format was [FBX](//usa.autodesk.com/adsk/servlet/index?siteID=123112&id=6837478) and it was using the the OBJ importer that is included with the FBX SDK. And indeed there was an OBJ reader bug reported on the FBX forum and those OBJ files also hung standalone the FBX converter from Autodesk. The Polytrans guy also heaped scorn on FBX (“wouldn’t touch it with a ten foot pole”) and stated his preference for Collada. Both FBX and Collada were add-ons to Polytrans but that didn’t solve the problem of reading the Game Exchange files, so I decided time to move on to Plan B - write my own FBX exporter in the original game code (which shows the importance of obtaining all the original assets, including the source code).

But once I started writing the FBX exporter, I understood the ten-foot-pole comment. For starters, FBX, which was created by MotionBuilder and then acquired by Autodesk, encompassed my fundamental objection to Game Exchange, but with a vengeance. Although FBX is the interchange format among Autodesk products, the file format is explicitly undocumented. The manual in fact states that it is undocumented and you should not try to write your own reader or writer - always use the FBX SDK. Reinforcing that, it seems they update the SDK and format almost yearly. A new SDK was released just before I started writing the exporter, and Unity couldn’t recognize the exported files, as surely it was using an earlier SDK. I found that if I converted my exported file using the FBX standalone converter to an older version of FBX then Unity could read it. So you’d think that in the SDK, they would make it easy to select which version of the format you want to use, but no, you can specify general attributes like whether you want binary or ascii, but aside from that you’ll get a list of string names of format versions, and those names are not documented. I added some code to print out all those names and still didn’t find the one I was looking for! Fortunately, a new version of Unity was released about that time with the latest FBX SDK (not the iPhone version, but I could import into Unity desktop first and then copy the already-imported project to the iPhone. Whew!)

Being forced to use the SDK wouldn’t be so bad if it was a thing of beauty, but it isn’t. Aside from the weirdness with accessing format names, it’s just hard to figure out what order to set things up in, the documentation has a lot more API than examples, and there are things that just don’t make sense to me, like you can specify a different material per polygon in a mesh but only one shading model for the whole mesh, which doesn’t translate well to Unity. Even textures didn’t show up in their respective materials on Unity import, even though that’s supposed to work, but was able to hand attach the textures by referring to the material and texture names in the FBX files, even given the undocumented status of the format. That also shows the importance of having a text file format.

Which brings us to Collada - a well-defined, standardized, text format. The “official” Collada book mentions reviving legacy games as one application of Collada, which sounds like exactly what I need. In an ideal world, the original HyperBowl files would have been Collada, and Unity would import Collada. But of course, Collada, didn’t even exist when HyperBowl was originally developed. And Unity does have a Collada importer, but I hear that it’s not that great, and I assume it suffers the same problem as the OBJ support - it’s based on a reader in the FBX SDK (the FBX SDK doesn’t support alternative formats well? What a surprise). Nevertheless, at one point when I couldn’t figure out what I was doing wrong with the FBX exporter, I stopped work on that and started writing a Collada exporter. I didn’t finish it, since I thought the chances of Unity reading it were pretty low, and setting up the material definitions lookedt like a huge pain (I’ll go with the critics on that one), but after exporting mesh vertices, normals and uv’s, I could see from the resulting Collada files where I went wrong in the FBX export.

I’d like to think the future is Collada. But the present is Autodesk. And now I feel bad about Game Exchange - if Nichimen had been acquired by Autodesk, Game Exchange could have been the FBX of today, and maybe that would be an improvement.

